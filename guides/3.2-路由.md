# è·¯ç”±
ä½ çš„ç½‘ç«™æˆ– Web åº”ç”¨ç¨‹åºçš„ç”¨æˆ·å¯ä»¥è®¿é—®ä¸åŒçš„ URLï¼Œä¾‹å¦‚ /ã€/about æˆ– /posts/1ã€‚è¦ä½¿è¿™äº› URL èµ·ä½œç”¨ï¼Œä½ å¿…é¡»å°†å®ƒä»¬å®šä¹‰ä¸ºè·¯ç”±ã€‚

è·¯ç”±é€šå¸¸ä½¿ç”¨ Route æ¨¡å—åœ¨ **start/routes.ts** æ–‡ä»¶ä¸­å®šä¹‰ï¼ˆä½†ä¸é™äºï¼‰ã€‚

ä¸€ä¸ªå…¸å‹çš„è·¯ç”±æ˜¯è·¯ç”±åŒ¹é…æ¨¡å¼ä½œä¸ºç¬¬ä¸€ä¸ªå‚æ•°ï¼Œè·¯ç”±å¤„ç†ç¨‹åºä½œä¸ºç¬¬äºŒä¸ªå‚æ•°ã€‚ä¾‹å¦‚ï¼š
```ts
import Route from '@ioc:Adonis/Core/Route'

Route.get('/', () => {
  return 'Hello world'
})
```

è·¯ç”±å¤„ç†ç¨‹åºè¿˜å¯ä»¥æŒ‡å‘æ§åˆ¶å™¨æ–¹æ³•ã€‚

```ts
import Route from '@ioc:Adonis/Core/Route'

Route.get('posts', 'PostsController.index')
```

## é»˜è®¤è·¯ç”±æ–‡ä»¶
æŒ‰ç…§æƒ¯ä¾‹ï¼Œè·¯ç”±åœ¨ **start/routes.ts** æ–‡ä»¶ä¸­æ³¨å†Œï¼Œç„¶ååœ¨å¯åŠ¨åº”ç”¨ç¨‹åºæ—¶ç”± AdonisJS é¢„åŠ è½½ã€‚ä½†æ˜¯ï¼Œè¿™ä¸æ˜¯å¼ºåˆ¶çš„ï¼Œä½ ä¹Ÿå¯ä»¥å°†è·¯ç”±ä¿å­˜åœ¨å•ç‹¬çš„æ–‡ä»¶ä¸­ã€‚

è®©æˆ‘ä»¬æ¢ç´¢ä¸€äº›ä»å…¶ä»–æ–‡ä»¶æ„å»ºå’ŒåŠ è½½è·¯ç”±çš„ä¸åŒæ–¹æ³•ã€‚

### åœ¨ routes.ts æ–‡ä»¶ä¸­å¯¼å…¥
ä¸€ç§æ–¹æ³•æ˜¯æ ¹æ®åº”ç”¨ç¨‹åºç»“æ„åœ¨ä¸åŒæ–‡ä»¶ä¸­å®šä¹‰è·¯ç”±ï¼Œç„¶åå°†æ‰€æœ‰è¿™äº›æ–‡ä»¶å¯¼å…¥ start/routes.ts æ–‡ä»¶ä¸­ã€‚
```ts
// routes.ts
import 'App/Modules/User/routes'
import 'App/Modules/Cart/routes'
import 'App/Modules/Product/routes'
```

### æ³¨å†Œä¸ºé¢„åŠ è½½æ–‡ä»¶
å¦ä¸€ç§æ–¹æ³•æ˜¯å®Œå…¨æ‘†è„±è·¯ç”±æ–‡ä»¶å¹¶ä½¿ç”¨è‡ªå®šä¹‰æ–‡ä»¶è·¯å¾„æ¥æ³¨å†Œè·¯ç”±ã€‚åœ¨è¿™ç§æƒ…å†µä¸‹ï¼Œè¯·ç¡®ä¿åœ¨ preloads æ•°ç»„ä¸‹çš„ .adonisrc.json æ–‡ä»¶ä¸­æ³¨å†Œè·¯å¾„ã€‚

```json
// .adonisrc.json
{
  "preloads": [
    "./start/routes",
    "./start/kernel",
    "add-path-to-your-routes-file"
  ]
}
```

## æŸ¥çœ‹æ‰€æœ‰è·¯ç”±
ä½ å¯ä»¥é€šè¿‡è¿è¡Œä»¥ä¸‹ Ace å‘½ä»¤æŸ¥çœ‹å·²æ³¨å†Œçš„è·¯ç”±ã€‚

```sh
node ace list:routes
```

é»˜è®¤æƒ…å†µä¸‹ï¼Œè·¯ç”±åœ¨ç»“æ„åŒ–è¡¨ä¸­æ‰“å°å¾—å¾ˆæ¼‚äº®ã€‚ä½†æ˜¯ï¼Œä½ ä¹Ÿå¯ä»¥é€šè¿‡ **--json** æ ‡å¿—ä»¥ JSON å­—ç¬¦ä¸²çš„å½¢å¼è®¿é—®å®ƒä»¬ã€‚

```ts
node ace list:routes --json > routes.json
```

## HTTP æ–¹æ³•
AdonisJS æä¾›æ–¹æ³•æ¥æ³¨å†Œå¸¸ç”¨ HTTP åŠ¨è¯çš„è·¯ç”±ã€‚ä¾‹å¦‚ï¼š

### post

```ts
Route.post('posts', async () => {})
```

### put

```ts
Route.put('posts/:id', async () => {})
```

### patch

```ts
Route.patch('posts/:id', async () => {})
```

### delete

```ts
Route.delete('posts/:id', async () => {})
```

### HTTP åè®®çš„å…¶ä½™éƒ¨åˆ†
å¯¹äºå…¶ä½™çš„ HTTP åŠ¨è¯ï¼Œä½ å¯ä»¥ä½¿ç”¨ **Route.route** æ–¹æ³•ã€‚

```ts
Route.route('/', ['OPTIONS', 'HEAD'], async () => {})
```

### æ‰€æœ‰å…¬å…± HTTP çš„è·¯ç”±
**Route.any** æ–¹æ³•æ³¨å†Œè·¯ç”±ä»¥å¤„ç†æ‰€æœ‰ä»¥ä¸‹ HTTP åŠ¨è¯çš„è¯·æ±‚ã€‚

- HEAD
- OPTIONS
- GET
- POST
- PUT
- PATCH
- DELETE

```ts
Route.any('csp-report', async () => {})
```

## è·¯ç”±å‚æ•°
è·¯ç”±å‚æ•°æä¾›äº†ä¸€ç§æ³¨å†Œ URL çš„æ–¹æ³•ï¼Œè¿™äº› URL å¯ä»¥æ¥å—åŠ¨æ€å€¼ä½œä¸º URL çš„ä¸€éƒ¨åˆ†ã€‚

å‚æ•°å§‹ç»ˆä»¥å†’å· : å¼€å¤´ï¼Œåè·Ÿå‚æ•°åç§°ã€‚ä¾‹å¦‚ï¼š

```ts
Route.get('/posts/:id', async ({ params }) => {
  return `Viewing post with id ${params.id}`
})
```

### å¯é€‰çš„å‚æ•° 
å‚æ•°ä¹Ÿå¯ä»¥é€šè¿‡é™„åŠ é—®å·æ ‡è®°ä¸ºå¯é€‰ã€‚ä½†æ˜¯ï¼Œè¯·ç¡®ä¿å¯é€‰å‚æ•°ä½äºå¿…éœ€å‚æ•°ä¹‹åã€‚

```ts
Route.get('/posts/:id?', async ({ params }) => {
  if (params.id) {
    return `Viewing post with id ${params.id}`
  }
  return 'Viewing all posts'
})
```

### é€šé…ç¬¦å‚æ•°
ä½ è¿˜å¯ä»¥ä½¿ç”¨ * å…³é”®å­—å®šä¹‰é€šé…ç¬¦å‚æ•°ã€‚é€šé…ç¬¦å‚æ•°æ•è·æ‰€æœ‰ URI æ®µã€‚ä¾‹å¦‚ï¼š

```ts
Route.get('docs/*', ({ params }) => {
  console.log(params['*'])
})
```

| URL                     | é€šé…ç¬¦å‚æ•°               |
| ----------------------- | ------------------------ |
| /docs/http/introduction | ['http', 'introduction'] |
| /docs/api/sql/orm       | ['api', 'sql', 'orm']    |

ä½ è¿˜å¯ä»¥åœ¨é€šé…ç¬¦å‚æ•°æ—è¾¹ä½¿ç”¨å‘½åå‚æ•°ã€‚ä½†æ˜¯ï¼Œè¯·ç¡®ä¿é€šé…ç¬¦å‚æ•°ä½äºå‘½åå‚æ•°ä¹‹åã€‚

```ts
Route.get('docs/:category/*', ({ params }) => {
  console.log(params.category)
  console.log(params['*'])
})
```

## å‚æ•°åŒ¹é…å™¨
å‚æ•°åŒ¹é…å™¨å…è®¸ä½ æ ¹æ®ç»™å®šçš„æ­£åˆ™è¡¨è¾¾å¼éªŒè¯å‚æ•°ã€‚å¦‚æœæ£€æŸ¥å¤±è´¥ï¼Œå°†è·³è¿‡è¯¥è·¯ç”±ã€‚

è€ƒè™‘ä¸‹é¢çš„ä¾‹å­ï¼Œæˆ‘ä»¬æƒ³é€šè¿‡å®ƒçš„ id å’Œ slug æ¥æŸ¥æ‰¾ä¸€ä¸ªå¸–å­ã€‚

```ts
Route
  .get('/posts/:id', async ({ params }) => {
    return `Viewing post using id ${params.id}`
  })
  .where('id', /^[0-9]+$/)

Route
  .get('/posts/:slug', async ({ params }) => {
    return `Viewing post using slug ${params.slug}`
  })
  .where('slug', /^[a-z0-9_-]+$/)
```

- å°†æ•°å­— id ä¼ é€’åˆ° **/posts** URL çš„è¯·æ±‚å°†è¢«è½¬å‘åˆ°ç¬¬ä¸€ä¸ªè·¯ç”±ã€‚ä¾‹å¦‚ï¼š/posts/1 æˆ– /posts/300
- è€ŒåŒ¹é… slug æ­£åˆ™è¡¨è¾¾å¼çš„è¯·æ±‚å°†è¢«è½¬å‘åˆ°ç¬¬äºŒæ¡è·¯ç”±ã€‚ä¾‹å¦‚ï¼š/posts/hello_world æˆ– /posts/adonis-101ã€‚
- æ‰¾ä¸åˆ°åŒ¹é…é¡¹æ—¶è¿”å› 404ã€‚

ä½ è¿˜å¯ä»¥ä½¿ç”¨ **Route.where** æ–¹æ³•å…¨å±€å®šä¹‰å‚æ•°åŒ¹é…å™¨ã€‚é™¤éåœ¨è·¯ç”±çº§åˆ«ä¸“é—¨è¦†ç›–ï¼Œå¦åˆ™å…¨å±€åŒ¹é…å™¨å°†åº”ç”¨äºæ‰€æœ‰è·¯ç”±ã€‚

```ts
Route.where('id', /^[0-9]+$/)
```

## å‚æ•°è½¬æ¢

URL çš„å‚æ•°éƒ¨åˆ†å§‹ç»ˆè¡¨ç¤ºä¸ºå­—ç¬¦ä¸²ã€‚ä¾‹å¦‚ï¼šåœ¨ URL /posts/1 ä¸­ï¼Œå€¼ 1 æ˜¯å­—ç¬¦ä¸²è€Œä¸æ˜¯æ•°å­—ï¼Œå› ä¸ºæ²¡æœ‰ç›´æ¥çš„æ–¹æ³•æ¥æ¨æ–­ URI æ®µçš„æ•°æ®ç±»å‹ã€‚

ä½†æ˜¯ï¼Œä½ å¯ä»¥é€šè¿‡ä½¿ç”¨å‚æ•°åŒ¹é…å™¨å®šä¹‰å¼ºåˆ¶è½¬æ¢å±æ€§æ¥æ‰‹åŠ¨å°†å‚æ•°å¼ºåˆ¶è½¬æ¢ä¸ºå®ƒä»¬çš„å®é™… JavaScript æ•°æ®ç±»å‹ã€‚
> åœ¨ä½¿ç”¨ cast å‡½æ•°æ—¶ï¼Œä½¿ç”¨ match å±æ€§éªŒè¯å‚æ•°æ˜¯ä¸€ç§å¾ˆå¥½çš„åšæ³•ã€‚

```ts
Route
  .get('posts/:id', 'PostsController.show')
  .where('id', {
    match: /^[0-9]+$/,
    cast: (id) => Number(id),
  })
```

## å†…ç½®åŒ¹é…å™¨
è·¯ç”±æ¨¡å—é™„å¸¦äº†ä»¥ä¸‹å¸¸ç”¨æ•°æ®ç±»å‹çš„å†…ç½®åŒ¹é…å™¨ã€‚

```ts
// Validate id to be numeric + cast to number data type
Route.where('id', Route.matchers.number())

// Validate id to be a valid uuid
Route.where('id', Route.matchers.uuid())

// Validate slug to match a given slug regex: regexr.com/64su0
Route.where('slug', Route.matchers.slug())
```

## URL ç”Ÿæˆ
> å½“æ— æ³•æŸ¥æ‰¾è·¯ç”±æ—¶ï¼Œç”¨äºç”Ÿæˆ URL çš„ API ä¼šå¼•å‘å¼‚å¸¸ã€‚

ä½ å¯ä»¥åˆ©ç”¨ URL ç”Ÿæˆ API ä¸ºé¢„æ³¨å†Œçš„è·¯ç”±ç”Ÿæˆ URLï¼Œè€Œä¸æ˜¯åœ¨åº”ç”¨ç¨‹åºä¸­çš„ä»»ä½•åœ°æ–¹ç¡¬ç¼–ç  URLã€‚ä¾‹å¦‚ï¼š
```ts
Route.get('/users/:id', 'UsersController.show')

// Positional arguments
const url = Route.makeUrl('/users/:id', [1])

// Named object keys
const url = Route.makeUrl('/users/:id', { id: 1 })
```

ä½ è¿˜å¯ä»¥ä½¿ç”¨ **Controller.method** åç§°æ¥å¼•ç”¨è·¯ç”±ã€‚

```ts
const url = Route.makeUrl('UsersController.show', { id: 1 })
```

æˆ–è€…ä½¿ç”¨è·¯ç”±çš„å”¯ä¸€åç§°ä½œä¸ºå‚è€ƒã€‚

```ts
Route
  .get('/users/:id', 'UsersController.show')
  .as('showUser') // ğŸ‘ˆ Route name

// Generate URL
const url = Route.makeUrl('showUser', { id: 1 })
```

### é™„åŠ æŸ¥è¯¢å­—ç¬¦ä¸²
ä½ å¯ä»¥é€šè¿‡å°†ç¬¬ä¸‰ä¸ªå‚æ•°ä¼ é€’ç»™ makeUrl æ–¹æ³•ï¼Œå°†æŸ¥è¯¢å­—ç¬¦ä¸²é™„åŠ åˆ°ç”Ÿæˆçš„ URLã€‚

```ts
const url = Route.makeUrl('showUser', [1], {
  qs: {
    verified: true,
  },
})
```

### åœ¨åŸŸå†…æŸ¥æ‰¾
ç”±äº AdonisJS å…è®¸ä½ ä¸ºä¸åŒçš„åŸŸåæ³¨å†Œè·¯ç”±ï¼Œå› æ­¤ä½ ä¹Ÿå¯ä»¥é™åˆ¶ **makeUrl** æœç´¢ç‰¹å®šåŸŸåã€‚

```ts
Route
  .get('/users/:id', 'UsersController.show')
  .domain(':tenant.adonisjs.com')

// Make URL
const url = Route.makeUrl('UsersController.show', [1], {
  domain: ':tenant.adonisjs.com',
})
```

### åŸŸåå‰ç¼€
ç”Ÿæˆçš„ URL å§‹ç»ˆæ˜¯æ²¡æœ‰ä»»ä½•åŸŸåçš„ç›¸å¯¹è·¯å¾„ã€‚ä½†æ˜¯ï¼Œä½ å¯ä»¥ä½¿ç”¨ prefixUrl å±æ€§å®šä¹‰ä¸€ä¸ªã€‚

```ts
const url = Route.makeUrl('UsersController.show', [1], {
  prefixUrl: 'https://foo.com',
})
```

### URL builder
URL builder æ˜¯ makeUrl æ–¹æ³•çš„æ›¿ä»£æ–¹æ³•ï¼Œå¹¶æä¾›äº†ä¸€ä¸ªæµç•…çš„ API æ¥åˆ¶ä½œ URLã€‚

```ts
const url = Route.builder()
  .params({ id: 1 })
  .qs({ verified: true })
  .prefixUrl('https://foo.com')
  .make('UsersController.show')
```

ä¸ºåŸŸåç”Ÿæˆä¸€ä¸ª URL

```ts
const url = Route.builderForDomain(':tenant.adonisjs.com')
  .params({ id: 1 })
  .qs({ verified: true })
  .prefixUrl('https://foo.com')
  .makeUrl('UsersController.show')
```

### åœ¨è§†å›¾ä¸­ç”Ÿæˆ URL
ä½ å¯ä»¥åœ¨æ¨¡æ¿æ–‡ä»¶ä¸­ä½¿ç”¨ **route** è¾…åŠ©å‡½æ•° æ¥ç”Ÿæˆ URLã€‚è¯¥è·¯ç”±ä¸ makeUrl æ–¹æ³•å…·æœ‰ç›¸åŒçš„ APIã€‚
```ts
Route.post('posts', 'PostsController.store').as('posts.create')
```

```html
<form method="POST" action="{{ route('posts.create') }}">
</form>
```

### é‡å®šå‘æœŸé—´çš„ URL ç”Ÿæˆ
ä½ è¿˜å¯ä»¥åœ¨é‡å®šå‘è¯·æ±‚æ—¶ç”Ÿæˆé¢„æ³¨å†Œè·¯ç”±çš„ URLã€‚ **redirect().toRoute()** ä¸ makeUrl æ–¹æ³•å…·æœ‰ç›¸åŒçš„ APIã€‚

```ts
Route
  .get('/users/:id', 'UsersController.show')
  .as('users.show')
```

```ts
Route.post('users', async ({ response }) => {
  // Create user
  response.redirect().toRoute('users.show', { id: user.id })
})
```

## SPA è·¯ç”±
å½“ä»ä¸ä½ çš„ AdonisJS åº”ç”¨ç¨‹åºç›¸åŒçš„è·¯ç”±å±‚æä¾› SPA æ—¶ï¼Œæµç¨‹å¯èƒ½å¦‚ä¸‹æ‰€ç¤ºã€‚

- ç¬¬ä¸€ä¸ªè¯·æ±‚å‘½ä¸­ AdonisJS åº”ç”¨ç¨‹åºã€‚
- ä½ ä½¿ç”¨å‰ç«¯è„šæœ¬å’Œæ ·å¼åŠ è½½ HTML å¸ƒå±€ã€‚
- ä»é‚£é‡Œå¼€å§‹ï¼Œè·¯ç”±å’Œæ¸²æŸ“ç”±å‰ç«¯æ¡†æ¶å¤„ç†ã€‚
- æœ‰äº†è¿™ä¸ªæµç¨‹ï¼Œä½ ä¼šå¸Œæœ› AdonisJS å§‹ç»ˆåŠ è½½ç›¸åŒçš„ HTML æ–‡ä»¶ï¼Œè€Œä¸ç®¡ URL æ˜¯ä»€ä¹ˆï¼Œå› ä¸ºè·¯ç”±é€»è¾‘æ”¾ç½®åœ¨å‰ç«¯åº”ç”¨ç¨‹åºä¸­ã€‚

ä½ å¯ä»¥é€šè¿‡å®šä¹‰é€šé…ç¬¦è·¯ç”±æ¥å®ç°æ­¤ç»“æœã€‚
```ts
Route.get('*', async ({ view }) => {
  return view.render('app')
})

// Shorter version
Route.on('*').render('app')
```

æ‰€æœ‰å…¶ä»– AdonisJS ç‰¹å®šè·¯ç”±ï¼ˆå¯èƒ½æ˜¯ä½ çš„ APIï¼‰éƒ½åº”è¯¥å®šä¹‰åœ¨é€šé…ç¬¦è·¯ç”±ä¹‹ä¸Šã€‚

```ts
Route.get('/api/users', 'UsersController.index')
Route.get('/api/posts', 'PostsController.index')

// SPA route
Route.on('*').render('app')
```

æˆ–è€…æ›´å¥½åœ°ä½¿ç”¨ /api å‰ç¼€å¯¹ API è·¯ç”±è¿›è¡Œåˆ†ç»„ã€‚

```ts
Route.group(() => {
  Route.get('/users', 'UsersController.index')
  Route.get('/posts', 'PostsController.index')
}).prefix('/api')

// SPA route
Route.on('*').render('app')
```

## è·¯ç”±åˆ†ç»„
AdonisJS æä¾›äº†ä¸€ç§å¾ˆå¥½çš„æ–¹æ³•æ¥åˆ†ç»„å¤šä¸ªç›¸ä¼¼æ€§è´¨çš„è·¯ç”±å¹¶æ‰¹é‡é…ç½®å®ƒä»¬ï¼Œè€Œä¸æ˜¯åœ¨æ¯ä¸ªè·¯ç”±ä¸Šé‡æ–°å®šä¹‰ç›¸åŒçš„å±æ€§ã€‚

é€šè¿‡å°†é—­åŒ…ä¼ é€’ç»™ **Route.group** æ–¹æ³•æ¥åˆ›å»ºç»„ã€‚åœ¨é—­åŒ…å†…å£°æ˜çš„è·¯ç”±æ˜¯å‘¨å›´ç»„çš„ä¸€éƒ¨åˆ†ã€‚

```ts
Route.group(() => {
  // All routes here are part of the group
})
```

ä½ è¿˜å¯ä»¥åˆ›å»ºåµŒå¥—ç»„ï¼ŒAdonisJS å°†æ ¹æ®åº”ç”¨è®¾ç½®çš„è¡Œä¸ºåˆå¹¶æˆ–è¦†ç›–å±æ€§ã€‚

### è·¯ç”±å‰ç¼€
ç»„é—­åŒ…å†…çš„æ‰€æœ‰ä»¥ä¸‹è·¯ç”±éƒ½å°†ä»¥ /api å­—ç¬¦ä¸²ä¸ºå‰ç¼€ã€‚

```ts
Route
  .group(() => {
    Route.get('/users', 'UsersController.index')
    Route.get('/posts', 'PostsController.index')
  })
  .prefix('/api')
```

åœ¨åµŒå¥—ç»„çš„æƒ…å†µä¸‹ï¼Œå‰ç¼€å°†ä»å¤–éƒ¨ç»„åº”ç”¨åˆ°å†…éƒ¨ç»„ã€‚

```ts
Route.group(() => {
  Route.group(() => {
    Route.get('/users', 'UsersController.index') // /api/v1/users
    Route.get('/posts', 'PostsController.index') // /api/v1/posts
  }).prefix('/v1')
}).prefix('/api')
```

### ä¸­é—´ä»¶
ä½ å¯ä»¥ä½¿ç”¨ **.middleware** æ–¹æ³•å°†ä¸­é—´ä»¶åº”ç”¨äºä¸€ç»„è·¯ç”±ã€‚ç»„ä¸­é—´ä»¶åœ¨è·¯ç”±çš„ä¸­é—´ä»¶ä¹‹å‰æ‰§è¡Œã€‚

```ts
Route.group(() => {
  Route.get('users', async () => {
    return 'handled'
  }).middleware('can:view_users')
}).middleware('auth')
```

### å‘½åè·¯ç”±

å‘½åä¸€ä¸ªç»„å°†ä¸ºå…¶æ‰€æœ‰è·¯ç”±æ·»åŠ ç»™å®šåç§°çš„å‰ç¼€ã€‚ä¾‹å¦‚ï¼š
```ts
// Named as users.index, users.store and so on
Route.resource('users', 'UserController')

Route
  .group(() => {
    // Named as api.users.index, api.users.store
    Route.resource('users', 'UserController')
  })
  .prefix('v1')
  .as('api')
```

## è·¯ç”±åŸŸå
ä½¿ç”¨è·¯ç”±æ¨¡å—ï¼Œä½ è¿˜å¯ä»¥ä¸ºç‰¹å®šåŸŸæˆ–å­åŸŸå®šä¹‰è·¯ç”±ã€‚åœ¨ä»¥ä¸‹ç¤ºä¾‹ä¸­ï¼Œä»…å½“å½“å‰è¯·æ±‚ä¸»æœºåä¸º **blog.adonisjs.com** æ—¶ï¼Œè·¯ç”±æ‰ä¼šåŒ¹é…ã€‚

> ä½ ä»ç„¶éœ€è¦é…ç½®ä»£ç†æœåŠ¡å™¨æ¥å¤„ç†æ³¨å†Œå­åŸŸçš„è¯·æ±‚å¹¶å°†å®ƒä»¬è½¬å‘åˆ°ä½ çš„ AdonisJS æœåŠ¡å™¨ã€‚

```ts
Route
  .group(() => {
    Route.get('/', 'PostsController.index')
    Route.get('/:id', 'PostsController.show')
  })
  .domain('blog.adonisjs.com')
```

åŸŸåä¹Ÿå¯ä»¥æ¥å—åŠ¨æ€å‚æ•°ã€‚ä¾‹å¦‚ï¼Œæ¥å—ç§Ÿæˆ·å­åŸŸçš„åŸŸåã€‚

```ts
Route
  .group(() => {
    Route.get('/', ({ subdomains }) => {
      console.log(subdomains.tenant)
    })
  })
  .domain(':tenant.adonisjs.com')
```

## ç®€æ´è·¯ç”±
ç®€æ´è·¯ç”±æ˜¯åœ¨æ²¡æœ‰ä»»ä½•æ˜¾å¼è·¯ç”±å¤„ç†ç¨‹åºçš„æƒ…å†µä¸‹å®šä¹‰çš„ã€‚ä½ å¯ä»¥æŠŠå®ƒä»¬çœ‹ä½œæ˜¯æŸäº›è¡Œä¸ºçš„æ·å¾„ã€‚

### render
åœ¨ä¸‹é¢çš„ç¤ºä¾‹ä¸­ï¼Œæˆ‘ä»¬é€šè¿‡é“¾æ¥ **.render** æ–¹æ³•æ¥å‘ˆç°æ¬¢è¿è§†å›¾ã€‚

```ts
Route.on('/').render('welcome')

```

**.render** æ¥å—æ¨¡æ¿æ•°æ®ä½œä¸ºç¬¬äºŒä¸ªå‚æ•°ã€‚

```ts
Route.on('/').render('welcome', { greeting: 'Hello world' })
```

### redirect
**.redirect** æ–¹æ³•å°†è¯·æ±‚é‡å®šå‘åˆ°é¢„å®šä¹‰çš„è·¯ç”±ã€‚å®ƒå°†ä½¿ç”¨æ¥è‡ªå®é™…è¯·æ±‚çš„è·¯ç”±å‚æ•°æ¥åˆ¶ä½œé‡å®šå‘è·¯ç”±çš„ URLã€‚

```ts
Route.on('/posts/:id').redirect('/articles/:id')

// Inline params
Route.on('/posts/:id').redirect('/articles/:id', { id: 1 })

// Custom status
Route.on('/posts/:id').redirect('/articles/:id', undefined, 301)
```

### redirectToUrl

è¦é‡å®šå‘åˆ°ç»å¯¹ URLï¼Œä½ å¯ä»¥ä½¿ç”¨ **redirectToUrl** æ–¹æ³•ã€‚

```ts
Route.on('/posts/:id').redirectToUrl('https://medium.com/my-blog')

// Custom status
Route.on('/posts/:id').redirectToUrl('https://medium.com/my-blog', 301)
```

## è®¿é—®å·²æ³¨å†Œçš„è·¯ç”±
ä½ å¯ä»¥é€šè¿‡è°ƒç”¨ **Route.toJSON** æ–¹æ³•è®¿é—®å·²æ³¨å†Œçš„è·¯ç”±ã€‚ä½†æ˜¯ï¼Œåœ¨è·¯ç”±æ–‡ä»¶ä¸­è°ƒç”¨æ­¤æ–¹æ³•ä¼šè¿”å›ä¸€ä¸ªç©ºæ•°ç»„ï¼Œå› ä¸ºè·¯ç”±æ˜¯åœ¨å¯åŠ¨ HTTP æœåŠ¡å™¨ä¹‹å‰ç¼–è¯‘çš„ã€‚

ä½ å¯ä»¥åœ¨ä¸­é—´ä»¶ã€æ§åˆ¶å™¨æˆ–æœåŠ¡æä¾›è€…çš„ start æ–¹æ³•ä¸­è¿è¡Œ **Route.toJSON()** æ–¹æ³•ã€‚é¿å…åœ¨ HTTP æœåŠ¡å™¨å‡†å¤‡å¥½ä¹‹å‰è®¿é—®è·¯ç”±ã€‚

```ts
import { ApplicationContract } from '@ioc:Adonis/Core/Application'

export default class AppProvider {
  public static needsApplication = true
  constructor(protected app: ApplicationContract) {}

  public async ready() {
    const Route = this.app.container.use('Adonis/Core/Route')
    console.log(Route.toJSON())
  }
}
```

![](https://res.cloudinary.com/adonis-js/image/upload/q_auto,f_auto/v1611994181/v5/routes-to-json.png)

## æ‰©å±•è·¯ç”±å™¨
è·¯ç”±å™¨æ˜¯å¤šä¸ªç±»çš„ç»„åˆï¼Œå¯ä»¥ä½¿ç”¨ macros æˆ– getter å‘æ‰€æœ‰ç±»æ·»åŠ è‡ªå®šä¹‰å±æ€§/æ–¹æ³•ã€‚

æ‰©å±•è·¯ç”±å™¨çš„æœ€ä½³ä½ç½®æ˜¯åœ¨è‡ªå®šä¹‰æœåŠ¡æä¾›è€…çš„å¼•å¯¼æ–¹æ³•ä¸­ã€‚æ‰“å¼€ **providers/AppProvider.ts** æ–‡ä»¶å¹¶åœ¨å…¶ä¸­å†™å…¥ä»¥ä¸‹ä»£ç ã€‚

```ts
import { ApplicationContract } from '@ioc:Adonis/Core/Application'

export default class AppProvider {
  public static needsApplication = true

  constructor(protected app: ApplicationContract) {}

  public async boot() {
    const Route = this.app.container.use('Adonis/Core/Route')

    Route.Route.macro('mustBeSigned', function () {
      this.middleware(async (ctx, next) => {
        if (!ctx.request.hasValidSignature()) {
          ctx.response.badRequest('Invalid signature')
          return
        }

        await next()
      })

      return this
    })
  }
}
```

åœ¨ä¸Šé¢çš„ç¤ºä¾‹ä¸­ï¼Œæˆ‘ä»¬åœ¨ Route ç±»ä¸­æ·»åŠ äº† mustBeSigned æ–¹æ³•ï¼Œè¯¥æ–¹æ³•åœ¨å†…éƒ¨æ³¨å†Œäº†ä¸€ä¸ªä¸­é—´ä»¶æ¥éªŒè¯è¯·æ±‚ç­¾åã€‚

ç°åœ¨ï¼Œæ‰“å¼€ start/routes.ts æ–‡ä»¶ä»¥ä½¿ç”¨æ­¤æ–¹æ³•ã€‚

```ts
Route
  .get('email/verify', 'OnboardingController.verifyEmail')
  .mustBeSigned()
```

### é€šçŸ¥ TypeScript æœ‰å…³è¯¥æ–¹æ³•çš„ä¿¡æ¯
mustBeSigned å±æ€§æ˜¯åœ¨è¿è¡Œæ—¶æ·»åŠ çš„ï¼Œå› æ­¤ TypeScript ä¸çŸ¥é“å®ƒã€‚ä¸ºäº†é€šçŸ¥ TypeScriptï¼Œæˆ‘ä»¬å°†ä½¿ç”¨å£°æ˜åˆå¹¶å¹¶å°†å±æ€§æ·»åŠ åˆ° RouteContract æ¥å£ã€‚

åœ¨è·¯å¾„ **contracts/route.ts** å¤„åˆ›å»ºä¸€ä¸ªæ–°æ–‡ä»¶ï¼ˆæ–‡ä»¶åä¸é‡è¦ï¼‰å¹¶åœ¨å…¶ä¸­ç²˜è´´ä»¥ä¸‹å†…å®¹ã€‚
```ts
declare module '@ioc:Adonis/Core/Route' {
  interface RouteContract {
    mustBeSigned(): this
  }
}
```

### æ‰©å±•è·¯ç”±èµ„æº
ä½ å¯ä»¥æŒ‰å¦‚ä¸‹æ–¹å¼æ‰©å±• RouteResource ç±»ï¼š

```ts
Route.RouteResource.macro('yourMacroName', fn)
```

```ts
declare module '@ioc:Adonis/Core/Route' {
  interface RouteResourceContract {
    yourMacroName(): this
  }
}
```

```ts
Route.resource().yourMacroName()
```

### æ‰©å±•è·¯ç”±ç»„
ä½ å¯ä»¥æŒ‰å¦‚ä¸‹æ–¹å¼æ‰©å±• RouteGroup ç±»ï¼š
```ts
Route.RouteGroup.macro('yourMacroName', fn)
```

```ts
declare module '@ioc:Adonis/Core/Route' {
  interface RouteGroupContract {
    yourMacroName(): this
  }
}
```

```ts
Route.group().yourMacroName()
```

### æ‰©å±•ç®€æ´è·¯ç”±
ä½ å¯ä»¥æŒ‰å¦‚ä¸‹æ–¹å¼æ‰©å±• BriskRoute ç±»ï¼š
```ts
Route.BriskRoute.macro('yourMacroName', fn)
```

```ts
declare module '@ioc:Adonis/Core/Route' {
  interface BriskRouteContract {
    yourMacroName(): this
  }
}
```

```ts
Route.on('/').yourMacroName()
```

## è¡¥å……é˜…è¯»

ä»¥ä¸‹æ˜¯ä¸€äº›é™„åŠ æŒ‡å—ï¼Œç”¨äºäº†è§£æœ‰å…³æœ¬æ–‡æ¡£æœªæ¶µç›–çš„ä¸»é¢˜çš„æ›´å¤šä¿¡æ¯ã€‚

- [Resourceful routes](https://docs.adonisjs.com/guides/controllers#resourceful-routes-and-controllers)
- [Route middleware](https://docs.adonisjs.com/guides/middleware)
- [Signed routes](https://docs.adonisjs.com/guides/security/signed-urls)