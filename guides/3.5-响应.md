# å“åº”

[response class](https://github.com/adonisjs/http-server/blob/develop/src/Response/index.ts) å®ä¾‹å¯¹è±¡è¿è¡Œä½ å“åº” HTTP è¯·æ±‚ï¼Œ AdonisJS å¼€ç®±å³ç”¨æ”¯æŒå‘é€ **HTML fragments**, **JSON objects**, **streams** ç­‰ç­‰ã€‚

ä½ å¯ä»¥ä»ä¼ é€’ç»™è·¯ç”±å¤„ç†ç¨‹åºï¼Œä¸­é—´ä»¶å’Œå¼‚å¸¸å¤„ç†ç¨‹åºçš„ HTTP ä¸Šä¸‹æ–‡å®ä¾‹è®¿é—® `response`

```ts
Route.get('/', (ctx) => {
  ctx.response.send('hello world')
})
```

## å‘é€å“åº”

å‘é€å“åº”çš„æœ€ç®€å•æ–¹æ³•æ˜¯è¿”å›è·¯ç”±å¤„ç†ç¨‹åºçš„å€¼ã€‚

```ts
Route.get('/', () => {
  /** Plain string */
  return 'This is the homepage'

  /** Html fragment */
  return '<p> This is the homepage </p>'

  /** JSON response */
  return { page: 'home' }

  /** Converted to ISO string */
  return new Date()
})
```

éšç€è¿”å›å€¼ï¼Œä½ è¿˜å¯ä»¥ä½¿ç”¨`response.send`æ–¹æ³•æ¥å‘é€å“åº”ã€‚ç¬¬ä¸€ä¸ªå‚æ•°æ˜¯è¯·æ±‚ä½“ï¼ˆä¸è¿”å›å€¼ç›¸åŒï¼‰ã€‚å¯é€‰åœ°ï¼Œä½ å¯ä»¥é€šè¿‡ç¬¬äºŒä¸ªå‚æ•°æ¥ç”Ÿæˆå¹¶è®¾ç½®[Etag](https://developer.mozilla.org/en-US/docs/Web/HTTP/Headers/ETag)

> ä½ è¿˜å¯ä»¥é€šè¿‡åœ¨`config/app.ts`æ–‡ä»¶ä¸­å¯ç”¨`http.etag`å±æ€§æ¥ä¸ºæ‰€æœ‰å“åº”å¯ç”¨ ETAG ç”Ÿæˆã€‚

```ts
response.send({ hello: 'world' })

// With etag
response.send({ hello: 'world' }, true)
```

### åºåˆ—åŒ–å“åº”ä½“

ä»¥ä¸‹æ˜¯å“åº”ç±»åºåˆ—åŒ–çš„æ•°æ®ç±»å‹åˆ—è¡¨ã€‚

- **Array**å’Œ**Object**ä½¿ç”¨[safe stringify function]ï¼ˆhttps://github.com/poppinss/utils/blob/develop/src/safestringify.tsï¼‰ã€‚è¯¥æ–¹æ³•ç±»ä¼¼äº`json.stringify`ï¼Œä½†åˆ é™¤å¾ªç¯å¼•ç”¨ã€‚
- **Number**å’Œ**Boolean**å€¼å°†è½¬æ¢ä¸ºå­—ç¬¦ä¸²ã€‚
- **Date**çš„å®ä¾‹é€šè¿‡è°ƒç”¨`toisoString`æ–¹æ³•å°†å…¶è½¬æ¢ä¸ºå­—ç¬¦ä¸²ã€‚
- **Regular expressions**å’Œ**error**å¯¹è±¡é€šè¿‡è°ƒç”¨å®ƒä»¬çš„ "toString" æ–¹æ³•è½¬æ¢ä¸ºå­—ç¬¦ä¸²ã€‚
- ä»»ä½•å…¶ä»–æ•°æ®ç±»å‹éƒ½ä¼šå¯¼è‡´å¼‚å¸¸ã€‚

### å†…å®¹ç±»å‹æ¨æ–­

å“åº”ç±»é€šè¿‡æ£€æŸ¥å“åº”ä¸»ä½“è‡ªåŠ¨è®¾ç½® `content-type` å’Œ `content-length` æ ‡é¢˜ã€‚

> åªæœ‰åœ¨è¯·æ±‚ç”Ÿå‘½å‘¨æœŸæœŸé—´æœªæ˜ç¡®è®¾ç½®å®ƒæ—¶ï¼Œæ‰ä¼šå®šä¹‰è‡ªåŠ¨**å†…å®¹ç±»å‹**æ ‡é¢˜ã€‚

- å†…å®¹ç±»å‹è®¾ç½®ä¸º`application/json`å½“å€¼æ˜¯æ•°ç»„å’Œå¯¹è±¡çš„æ—¶å€™ã€‚
- å†…å®¹ç±»å‹è®¾ç½®ä¸º`text/html`å½“å€¼æ˜¯ HTML çš„æ—¶å€™ã€‚
- å†…å®¹ç±»å‹è®¾ç½®ä¸º`text/javascript`å½“å€¼å“åº”ä¸º JSONP çš„æ—¶å€™ã€‚
- ä»»ä½•å…¶ä»–å†…å®¹ç±»å‹è®¾ç½®ä¸º`text/plain`ã€‚

## æ‡’å“åº”
è®¸å¤š Node.js æ¡†æ¶ä¼šåœ¨ä½ è°ƒç”¨ `response.send` æ–¹æ³•åç«‹å³å°†å“åº”å†™å…¥ä¼ å‡ºæµã€‚ç„¶è€Œï¼ŒAdonisJS **æ²¡æœ‰**åšåŒæ ·çš„äº‹æƒ…ã€‚ç›¸åï¼Œæˆ‘ä»¬åœ¨ç¼–å†™æœ€ç»ˆå“åº”ä¹‹å‰ç­‰å¾…è·¯ç”±å¤„ç†ç¨‹åºå’Œä¸­é—´ä»¶è°ƒç”¨å®Œæˆã€‚

è¿™ç§æ–¹æ³•ç¡®ä¿æœ€åä¸€æ¬¡è°ƒç”¨ `response.send` æ€»æ˜¯è·èƒœã€‚åœ¨å¤§å¤šæ•°æƒ…å†µä¸‹ï¼Œæ­¤è¡Œä¸ºæ ¹æœ¬ä¸ä¼šå½±å“ä½ æˆ–ä½ çš„åº”ç”¨ç¨‹åºã€‚ä½†æ˜¯ï¼Œå®ƒå…è®¸ä½ åœ¨ä¸­é—´ä»¶å†…å¯¹å“åº”è¿›è¡Œåå¤„ç†ã€‚

ä»¥ä¸‹æ˜¯å°† `camelCase` å¯¹è±¡é”®è½¬æ¢ä¸º `snake_case` çš„ç¤ºä¾‹ã€‚

> ä»¥ä¸‹ç¤ºä¾‹ä¸æ˜¯è½¬æ¢å“åº”çš„æœ€ä½³æ–¹å¼ã€‚è¿™åªæ˜¯ä¸€ä¸ªæ¼”ç¤ºå¦‚ä½•å¯¹å“åº”è¿›è¡Œåå¤„ç†

```ts
// highlight-start
import snakeCaseKeys from 'snakecase-keys'
// highlight-end

Route
  .get('/', async ({ response }) => {
    response.send({ fullName: 'Harminder Virk' })
  })
  .middleware(async ({ response }, next) => {
    await next()

    // highlight-start
    /**
     * Following code is executed after the route handler.
     * Read the middleware guide to learn how it works
     */
    const existingBody = response.lazyBody[0]
    if (!existingBody || existingBody.constructor !== Object) {
      return
    }

    response.send(snakeCaseKeys(existingBody))
    // highlight-end
  })
```

åœ¨ä¸Šé¢çš„ç¤ºä¾‹ä¸­ï¼Œè·¯ç”±å¤„ç†ç¨‹åºä½¿ç”¨ `response.send` æ–¹æ³•å†™å…¥å“åº”æ­£æ–‡ã€‚ä½†æ˜¯ï¼Œä¸‹æ¸¸ä¸­é—´ä»¶ä¼šæ”¹å˜æ­£æ–‡å¹¶å†æ¬¡ä½¿ç”¨`response.send`é‡æ–°ç¼–å†™å®ƒã€‚

ç”±äºå“åº”ä¸»ä½“æ˜¯å»¶è¿Ÿè¯„ä¼°çš„ï¼ŒAdonisJS å°†å§‹ç»ˆé€šè¿‡æ£€æŸ¥æœ€è¿‘çš„å“åº”ä¸»ä½“æ¥è®¾ç½® **content-length** å’Œ **content-type** æ ‡å¤´ã€‚

## å“åº”çŠ¶æ€å’Œæ ‡å¤´
ä»¥ä¸‹æ˜¯ä½¿ç”¨å“åº”æ ‡å¤´å’Œå“åº”çŠ¶æ€çš„æ–¹æ³•ã€‚

### header

`response.header` æ–¹æ³•å®šä¹‰äº† HTTP å“åº”å¤´ã€‚ä½¿ç”¨æ­¤æ–¹æ³•ä¼šè¦†ç›–ç°æœ‰çš„æ ‡å¤´ï¼ˆå¦‚æœæœ‰ï¼‰ã€‚

```ts
response.header('Content-type', 'text/html')
```

---

### append

`response.append` æ–¹æ³•ç±»ä¼¼äº `header` æ–¹æ³•ã€‚ä½†æ˜¯ï¼Œå®ƒä¼šé™„åŠ åˆ°ç°æœ‰çš„æ ‡å¤´å€¼ï¼ˆå¦‚æœæœ‰ï¼‰ã€‚
```ts
response.append('Set-cookie', 'cookie-value')
```

---

### removeHeader

`response.removeHeader` å…è®¸åˆ é™¤ç°æœ‰çš„å“åº”æ ‡å¤´ã€‚

```ts
response.removeHeader('Content-type')
```

---

### getHeader

`response.getHeader` æ–¹æ³•è¿”å›ç°æœ‰æ ‡å¤´çš„å€¼ã€‚

```ts
const cookie = response.getHeader('Set-cookie')
```

---

### safeHeader

`response.safeHeader` æ–¹æ³•ç±»ä¼¼äº `header` æ–¹æ³•ã€‚ä½†æ˜¯ï¼Œå®ƒä»…åœ¨å°šæœªå®šä¹‰çš„æƒ…å†µä¸‹å®šä¹‰æ ‡é¢˜ã€‚

```ts
response.safeHeader('Content-type', 'application/json')
```

---

### status

`response.status` æ–¹æ³•å®šä¹‰äº† HTTP å“åº”çš„çŠ¶æ€ã€‚ä½ è¿˜å¯ä»¥ä½¿ç”¨ [descriptive methods](#descriptive-response-methods) å°†çŠ¶æ€å’Œå“åº”æ­£æ–‡ä¸€èµ·è®¾ç½®ã€‚

```ts
response.status(401)
```

---

### safeStatus

ä¸ `status` æ–¹æ³•ä¸€æ ·ï¼Œ`response.status` ä»…å®šä¹‰å°šæœªå®šä¹‰çš„çŠ¶æ€ã€‚

```ts
response.safeStatus(401)
```

## æµä¸æ–‡ä»¶ä¸‹è½½

AdonisJS å¯¹ç®¡é“æµå’Œæ–‡ä»¶ä¸‹è½½å…·æœ‰ä¸€æµçš„æ”¯æŒã€‚æ­¤å¤–ï¼Œæˆ‘ä»¬ç¡®ä¿åœ¨å‡ºç°é”™è¯¯æ—¶æ­£ç¡®æ¸…ç†æµã€‚

### stream

`response.stream` æ–¹æ³•å…è®¸å°†æµé€šè¿‡ç®¡é“ä¼ è¾“åˆ°å“åº”ã€‚æ­¤æ–¹æ³•ä¸è®¾ç½® **content-type** å’Œ **content-length** æ ‡å¤´ï¼Œä½ å¿…é¡»æ‰‹åŠ¨è®¾ç½®å®ƒä»¬ã€‚

```ts
const image = fs.createReadStream('./some-file.jpg')
response.stream(image)
```

å¦‚æœå‡ºç°é”™è¯¯ï¼Œå°†å‘å®¢æˆ·ç«¯å‘é€ 500 å“åº”ã€‚ä½†æ˜¯ï¼Œä½ å¯ä»¥é€šè¿‡å®šä¹‰`callback`æ¥å‘é€è‡ªå®šä¹‰çŠ¶æ€ä»£ç å’Œæ¶ˆæ¯ã€‚å›è°ƒå¿…é¡»è¿”å›ä¸€ä¸ªåŒ…å«å“åº”æ¶ˆæ¯å’Œå“åº”çŠ¶æ€ä»£ç çš„æ•°ç»„ã€‚

```ts
response.stream(image, (error) => {
  return ['Unable to send file', 400]
})
```

---

### download

`download` æ–¹æ³•é€šè¿‡ä»ç£ç›˜è¯»å–æ–‡ä»¶å°†æ–‡ä»¶æµå¼ä¼ è¾“åˆ°å®¢æˆ·ç«¯ã€‚ç„¶è€Œï¼Œä¸æµæ–¹æ³•ä¸åŒçš„æ˜¯ï¼Œ`download` æ–¹æ³•ç¡®å®è®¾ç½®äº† **content-type** å’Œ **content-length** æ ‡å¤´ã€‚

```ts
const filePath = Application.tmpPath('uploads/some-file.jpg')
response.download(filePath)
```

æˆ–è€…ï¼Œä½ è¿˜å¯ä»¥ä¸ºæ–‡ä»¶å®šä¹‰ ETagã€‚

```ts
const filePath = Application.tmpPath('uploads/some-file.jpg')
response.download(filePath, true)
```

ä½ å¯ä»¥é€šè¿‡å°†`callback`ä½œä¸ºç¬¬ä¸‰ä¸ªå‚æ•°ä¼ é€’æ¥å®šä¹‰è‡ªå®šä¹‰çŠ¶æ€ä»£ç å’Œæ¶ˆæ¯ã€‚

```ts
const filePath = Application.tmpPath('uploads/some-file.jpg')

response.download(filePath, true, (error) => {
  if (error.code === 'ENOENT') {
    return ['File does not exists', 404]
  }

  return ['Cannot download file', 400]
})
```

---

### attachment

`response.attachment` ç±»ä¼¼äº `download` æ–¹æ³•ã€‚ä½†æ˜¯ï¼Œå®ƒå…è®¸è‡ªå®šä¹‰ä¸‹è½½çš„æ–‡ä»¶åå¹¶å®šä¹‰ [Content-Disposition](https://developer.mozilla.org/en-US/docs/Web/HTTP/Headers/Content-Disposition) æ ‡å¤´ã€‚

```ts
const filePath = Application.tmpPath('uploads/some-file.jpg')
response.attachment(filePath)

// define custom name
response.attachment(filePath, 'foo.jpg')

// define custom disposition
response.attachment(filePath, 'foo.jpg', 'inline')
```

## é‡å®šå‘

å“åº”ç±»å…¬å¼€äº†ä¸€ä¸ªä¸°å¯Œçš„ API æ¥å¤„ç†é‡å®šå‘ï¼ŒåŒ…æ‹¬å°†ç”¨æˆ·é‡å®šå‘åˆ°è·¯ç”±ã€é‡å®šå‘å›ä¸Šä¸€é¡µä»¥åŠè½¬å‘ç°æœ‰çš„æŸ¥è¯¢å­—ç¬¦ä¸²ã€‚

ä½ å¯ä»¥ä½¿ç”¨ `response.redirect()` æ–¹æ³•è·å– [Redirect ç±»](https://github.com/adonisjs/http-server/blob/develop/src/Redirect/index.ts) çš„å®ä¾‹ã€‚

```ts
// Redirect back
response.redirect().back()

// Redirect to a url
response.redirect().toPath('/some/url')
```

### è‡ªå®šä¹‰å“åº”ç 

é»˜è®¤æƒ…å†µä¸‹ï¼Œä½¿ç”¨"302"çŠ¶æ€ç ã€‚ä½†æ˜¯ï¼Œä½ å¯ä»¥ä½¿ç”¨ `.status` æ–¹æ³•è¦†ç›–å®ƒã€‚

```ts
response.redirect().status(301).toPath('/some/url')
```

### é‡å®šå‘åˆ°ä¸€ä¸ªè·¯ç”±

ä½ è¿˜å¯ä»¥ä½¿ç”¨ `.toRoute` æ–¹æ³•å°†è¯·æ±‚é‡å®šå‘åˆ°å‘½åè·¯ç”±ã€‚

```ts
response.redirect().toRoute('PostsController.show', { id: 1 })
```

### å®šä¹‰/è½¬å‘æŸ¥è¯¢å­—ç¬¦ä¸²

`.withQs` å…è®¸ä½ è½¬å‘ç°æœ‰çš„æŸ¥è¯¢å­—ç¬¦ä¸²æˆ–åœ¨é‡å®šå‘æœŸé—´å®šä¹‰è‡ªå®šä¹‰æŸ¥è¯¢å­—ç¬¦ä¸²ã€‚

```ts
response
  .redirect()
  .withQs() // ğŸ‘ˆ forwardes the existing qs
  .back()

response
  .redirect()
  .withQs({ sort: 'id' }) // ğŸ‘ˆ custom
  .back()
```

### withQs å¸¦å‚æ•°

ä½¿ç”¨è‡ªå®šä¹‰å¯¹è±¡å¤šæ¬¡è°ƒç”¨ `.withQs` æ–¹æ³•ä¼šå°†å¯¹è±¡åˆå¹¶åœ¨ä¸€èµ·ã€‚ä½†æ˜¯ï¼Œä½ å¯ä»¥å°†å®ƒä¸ `.clearQs` æ–¹æ³•ç»“åˆä½¿ç”¨æ¥æ¸…é™¤ç°æœ‰å¯¹è±¡ã€‚ä¾‹å¦‚ï¼š

```ts
response
  .redirect()
  .withQs({ sort: 'id' })
  .clearQs()
  .withQs({ filters: { name: 'virk' } })
  .toPath('/users')

// URL: /users?filters[name]=virk
```

### withQs ä¸å¸¦å‚æ•°

è°ƒç”¨ä¸å¸¦ä»»ä½•å‚æ•°çš„ `withQs` æ–¹æ³•ä¼šå°†ç°æœ‰æŸ¥è¯¢å­—ç¬¦ä¸²è½¬å‘åˆ°é‡å®šå‘çš„ URLã€‚å¦‚æœä½ å°†ç”¨æˆ·é‡å®šå‘å›æ—§é¡µé¢ï¼Œæˆ‘ä»¬å°†ä½¿ç”¨æ¥è‡ª `referrer` æ ‡å¤´ URL çš„æŸ¥è¯¢å­—ç¬¦ä¸²ã€‚

```ts
response.redirect().withQs().back() // ğŸ‘ˆ referrer header qs is used
```

```ts
response.redirect().withQs().toPath('/users') // ğŸ‘ˆ current URL qs is used
```

## ä¸­æ­¢å’Œå“åº”

å“åº”ç±»å…è®¸ä½ ä½¿ç”¨ `response.abort` æˆ– `response.abortIf` æ–¹æ³•ä¸­æ­¢å½“å‰çš„ HTTP è¯·æ±‚ã€‚

### abort

`response.abort` æ–¹æ³•é€šè¿‡å¼•å‘ [AbortException](https://github.com/adonisjs/http-server/blob/develop/src/Response/index.ts#L44) ä¸­æ­¢å½“å‰è¯·æ±‚

è¯¥æ–¹æ³•æ€»å…±æ¥å—ä¸¤ä¸ªå‚æ•°ï¼šå³å“åº”æ­£æ–‡å’Œå¯é€‰çŠ¶æ€ã€‚

```ts
if (!auth.user) {
  response.abort('Not authenticated')

  // with custom status
  response.abort('Not authenticated', 401)
}
```

---

### abortIf

`response.abortIf` æ–¹æ³•æ¥å—ä¸€ä¸ªæ¡ä»¶å¹¶åœ¨æ¡ä»¶ä¸ºçœŸæ—¶ä¸­æ­¢è¯·æ±‚ã€‚

```ts
response.abortIf(!auth.user, 'Not authenticated', 401)
```

---

### abortUnless

`response.abortUnless` æ–¹æ³•ä¸ abortIf æ–¹æ³•ç›¸åã€‚

```ts
response.abortUnless(auth.user, 'Not authenticated', 401)
```

## å…¶ä»–æ–¹æ³•å’Œå±æ€§

ä»¥ä¸‹æ˜¯å“åº”ç±»ä¸­å¯ç”¨çš„å…¶ä»–æ–¹æ³•å’Œå±æ€§çš„åˆ—è¡¨ã€‚

### finished

æŸ¥æ‰¾å“åº”æ˜¯å¦å·²å†™å…¥ä¼ å‡ºæµã€‚

```ts
if (!response.finished) {
  response.send()
}
```

---

### headersSent

Node.js [res.headersSent](https://nodejs.org/dist/latest-v15.x/docs/api/http.html#http_response_headerssent) å±æ€§çš„åˆ«åã€‚

---

### isPending

è¯¥å±æ€§ä¸ `response.finished` å±æ€§ç›¸åã€‚

```ts
if (response.isPending) {
  response.send()
}
```

---

### vary

å®šä¹‰ [HTTP å˜åŒ–æ ‡å¤´](https://developer.mozilla.org/en-US/docs/Web/HTTP/Headers/Vary) çš„å¿«æ·æ–¹å¼ã€‚å¤šæ¬¡è°ƒç”¨ `vary` æ–¹æ³•å°†è¿½åŠ åˆ°ç°æœ‰æ ‡é¢˜åˆ—è¡¨ä¸­ã€‚

```ts
response.vary('Origin')

// Set multiple headers
response.vary('Accept, User-Agent')
```

---

### location

è®¾ç½® [HTTP ä½ç½®æ ‡å¤´](https://developer.mozilla.org/en-US/docs/Web/HTTP/Headers/Location) çš„å¿«æ·æ–¹å¼ã€‚

```ts
response.location('/dashboard')
```

---

### type

è®¾ç½® [HTTP å†…å®¹ç±»å‹æ ‡å¤´](https://developer.mozilla.org/en-US/docs/Web/HTTP/Headers/Content-Type) çš„å¿«æ·æ–¹å¼ã€‚

```ts
response.type('application/json')
```

ä½ è¿˜å¯ä»¥ä½¿ç”¨å…³é”®å­—æ¥å®šä¹‰å†…å®¹ç±»å‹ã€‚ä¾‹å¦‚ï¼š

```ts
response.type('json') // defines content-type=application/json
response.type('html') // defines content-type=text/html
```

## æè¿°æ€§å“åº”æ–¹æ³•

å“åº”ç±»æœ‰ä¸€å †æè¿°æ€§æ–¹æ³•ï¼ˆæ¯ä¸ª HTTP çŠ¶æ€ä¸€ä¸ªï¼‰æ¥å‘é€å“åº”æ­£æ–‡å¹¶åŒæ—¶è®¾ç½®çŠ¶æ€ã€‚ä¾‹å¦‚ï¼š

```ts
response.badRequest({ error: 'Invalid login credentials' })
response.forbidden({ error: 'Unauthorized' })
response.created({ data: user })
```

[è¿™é‡Œæ˜¯]ï¼ˆhttps://github.com/adonisjs/http-server/blob/ea55c2a65fd388373d0b4e35ae45bee9cb096d02/src/Response/index.ts#L937-L1145ï¼‰æ‰€æœ‰å¯ç”¨æ–¹æ³•çš„åˆ—è¡¨ã€‚

## æ‰©å±•å“åº”ç±»

ä½ å¯ä»¥ä½¿ç”¨å®æˆ– getter æ‰©å±• Response ç±»ã€‚æ‰©å±•å“åº”çš„æœ€ä½³ä½ç½®æ˜¯åœ¨è‡ªå®šä¹‰æœåŠ¡æä¾›è€…å†…éƒ¨ã€‚

æ‰“å¼€é¢„å…ˆå­˜åœ¨çš„ `providers/AppProvider.ts` æ–‡ä»¶å¹¶åœ¨ `boot` æ–¹æ³•ä¸­å†™å…¥ä»¥ä¸‹ä»£ç ã€‚

```ts
import { ApplicationContract } from '@ioc:Adonis/Core/Application'

export default class AppProvider {
  public static needsApplication = true
  constructor(protected app: ApplicationContract) {}

  // highlight-start
  public async boot() {
    const Response = this.app.container.use('Adonis/Core/Response')

    Response.macro('flash', function (messages) {
      this.ctx!.session.flash(messages)
      return this
    })
  }
  // highlight-end
}
```

åœ¨ä¸Šé¢çš„ç¤ºä¾‹ä¸­ï¼Œæˆ‘ä»¬åœ¨å“åº”ç±»ä¸­æ·»åŠ äº† `flash` æ–¹æ³•ã€‚å®ƒé€šè¿‡å†…éƒ¨è°ƒç”¨ `session.flash` æ–¹æ³•æ¥è®¾ç½® flash æ¶ˆæ¯ã€‚

ä½ å¯ä»¥æŒ‰å¦‚ä¸‹æ–¹å¼ä½¿ç”¨æ–°æ·»åŠ çš„æ–¹æ³•ã€‚

```ts
Route.post('users', ({ response }) => {
  response.flash({ success: 'User created' })
})
```

### é€šçŸ¥ TypeScript è¯¥æ–¹æ³•

`flash` å±æ€§æ˜¯åœ¨è¿è¡Œæ—¶æ·»åŠ çš„ï¼Œå› æ­¤ TypeScript ä¸çŸ¥é“å®ƒã€‚ä¸ºäº†é€šçŸ¥ TypeScriptï¼Œæˆ‘ä»¬å°†ä½¿ç”¨ [declaration merging](https://www.typescriptlang.org/docs/handbook/declaration-merging.html#merging-interfaces) å¹¶å°†å±æ€§æ·»åŠ åˆ° `ResponseContract` æ¥å£ã€‚

åœ¨è·¯å¾„ `contracts/response.ts` å¤„åˆ›å»ºä¸€ä¸ªæ–°æ–‡ä»¶ï¼ˆæ–‡ä»¶åä¸é‡è¦ï¼‰å¹¶å°†ä»¥ä¸‹å†…å®¹ç²˜è´´åˆ°å…¶ä¸­ã€‚

```ts
// title: contracts/response.ts
declare module '@ioc:Adonis/Core/Response' {
  interface ResponseContract {
    flash(messages: any): this
  }
}
```

## è¡¥å……é˜…è¯»

ä»¥ä¸‹æ˜¯ä¸€äº›é™„åŠ æŒ‡å—ï¼Œç”¨äºäº†è§£æœ‰å…³æœ¬æ–‡æ¡£æœªæ¶µç›–çš„ä¸»é¢˜çš„æ›´å¤šä¿¡æ¯ã€‚

- [Cookies](./cookies.md)
- [Session](./session.md)
- [Views](../views/introduction.md)
